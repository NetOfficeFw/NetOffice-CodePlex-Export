[
  {
    "Id": "1002476",
    "ThreadId": "433445",
    "Html": "Hi,\r<br />\n<br />\nI'm currently working on an excel plugin where I want to enable/disable Ribbons at runtime. To be more specific - depending on existing document properties - I want certain ribbons to be enabled/disabled. (clickable or grayed out).\r<br />\n<br />\nIn an earlier post, artnib mentioned the getEnabled method which could be used for ribbons. From what I observed, this method is only evaluted once - while the add-in is initialized. \r<br />\n<br />\nI don't really understand, how I can bring this in line with events, e.g. when a new workbook is opened.\r<br />\n<br />\nAny hints how this can be achieved?<br />\n",
    "PostedDate": "2013-02-17T11:54:10.68-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1003140",
    "ThreadId": "433445",
    "Html": "In your ribbon markup specify<br />\n<ol>\n<li>method which gets ribbon reference (onLoad attribute)</li>\n<li>\nmethod which returns Enabled property value for the ribbon control <br />\n</li>\n</ol>\n<div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">&lt;?</span><span style=\"color:#A31515;\">xml</span> <span style=\"color:Red;\">version</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">1.0</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">encoding</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">utf-8</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">?&gt;</span>\n<span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">customUI</span> <span style=\"color:Red;\">xmlns</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">http://schemas.microsoft.com/office/2006/01/customui</span><span style=\"color:Black;\">&quot;</span>\n          <span style=\"color:Red;\">onLoad</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">RibbonLoaded</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">&gt;</span>\n  <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">ribbon</span><span style=\"color:Blue;\">&gt;</span>\n    <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">tabs</span><span style=\"color:Blue;\">&gt;</span>\n        <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">tab</span> <span style=\"color:Red;\">id</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">ExcelRibbonAddin</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">label</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">ExcelRibbonAddin</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>\n        <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">group</span> <span style=\"color:Red;\">id</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">group1</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">label</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">Example</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">&gt;</span>\n          <span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">button</span> <span style=\"color:Red;\">id</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">nextButton</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">label</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">Go Next Sheet</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">size</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">large</span><span style=\"color:Black;\">&quot;</span>\n                  <span style=\"color:Red;\">onAction</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">OnAction</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">getEnabled</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">GetEnabled</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">/&gt;</span>\n        <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">group</span><span style=\"color:Blue;\">&gt;</span>\n      <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">tab</span><span style=\"color:Blue;\">&gt;</span>\n    <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">tabs</span><span style=\"color:Blue;\">&gt;</span>\n  <span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">ribbon</span><span style=\"color:Blue;\">&gt;</span>\n<span style=\"color:Blue;\">&lt;/</span><span style=\"color:#A31515;\">customUI</span><span style=\"color:Blue;\">&gt;</span>\r\n</pre></div>In your addin code<br />\n<ol>\n<li>add field which holds ribbon reference (_ribbon)</li>\n<li>add method which gets ribbon reference (RibbonLoaded)</li>\n<li>add method which returns Enabled property value for the ribbon control (GetEnabled) </li>\n<li>\napplication event handler which invalidates the ribbon control<br />\n</li>\n</ol>\n<div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">Dim</span> <span style=\"color:Blue;\">WithEvents</span> _application <span style=\"color:Blue;\">As</span> Excel.Application\n<span style=\"color:Blue;\">Dim</span> _ribbon <span style=\"color:Blue;\">As</span> NetOffice.OfficeApi.IRibbonUI\n\n<span style=\"color:Blue;\">#Region</span> <span style=\"color:#A31515;\">&quot;Ribbon callbacks&quot;</span>\n\n  <span style=\"color:Blue;\">Public</span> <span style=\"color:Blue;\">Sub</span> RibbonLoaded(ribbon <span style=\"color:Blue;\">As</span> Office.IRibbonUI)\n    _ribbon = ribbon\n  <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Sub</span>\n\n  <span style=\"color:Blue;\">Public</span> <span style=\"color:Blue;\">Function</span> GetEnabled(<span style=\"color:Blue;\">ByVal</span> control <span style=\"color:Blue;\">As</span> Office.IRibbonControl) <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">Boolean</span>\n    <span style=\"color:Blue;\">Select</span> <span style=\"color:Blue;\">Case</span> control.Id\n      <span style=\"color:Blue;\">Case</span> <span style=\"color:#A31515;\">&quot;nextButton&quot;</span>\n        <span style=\"color:Blue;\">Return</span> _application.ActiveWorkbook.Sheets.<span style=\"color:Blue;\">Count</span> &gt; 1\n      <span style=\"color:Blue;\">Case</span> <span style=\"color:Blue;\">Else</span>\n        MessageBox.Show(<span style=\"color:#A31515;\">&quot;Unkown Control Id: &quot;</span> + control.Id)\n    <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Select</span>\n  <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Function</span>\n\n<span style=\"color:Blue;\">#End Region</span>\n\n<span style=\"color:Blue;\">Public</span> <span style=\"color:Blue;\">Sub</span> WorkbookOpen(wbk <span style=\"color:Blue;\">As</span> Excel.Workbook) <span style=\"color:Blue;\">Handles</span> _application.WorkbookOpenEvent\n    _ribbon.InvalidateControl(<span style=\"color:#A31515;\">&quot;nextButton&quot;</span>)\n <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Sub</span>\n\n<span style=\"color:Blue;\">Public</span> <span style=\"color:Blue;\">Sub</span> OnAction(<span style=\"color:Blue;\">ByVal</span> control <span style=\"color:Blue;\">As</span> Office.IRibbonControl)\n    <span style=\"color:Blue;\">Try</span>\n\n      <span style=\"color:Blue;\">Select</span> <span style=\"color:Blue;\">Case</span> control.Id\n        <span style=\"color:Blue;\">Case</span> <span style=\"color:#A31515;\">&quot;nextButton&quot;</span>\n          <span style=\"color:Blue;\">Dim</span> wbk <span style=\"color:Blue;\">As</span> Excel.Workbook\n          wbk = _application.ActiveWorkbook\n          <span style=\"color:Blue;\">Dim</span> sheet <span style=\"color:Blue;\">As</span> Excel.Worksheet\n          sheet = wbk.ActiveSheet\n          <span style=\"color:Blue;\">Dim</span> index = sheet.Index\n          <span style=\"color:Blue;\">If</span> index &lt; wbk.Sheets.<span style=\"color:Blue;\">Count</span> <span style=\"color:Blue;\">Then</span>\n            wbk.Sheets(index + 1).Activate()\n          <span style=\"color:Blue;\">Else</span>\n            wbk.Sheets(index - 1).Activate()\n          <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">If</span>\n        <span style=\"color:Blue;\">Case</span> <span style=\"color:Blue;\">Else</span>\n          MessageBox.Show(<span style=\"color:#A31515;\">&quot;Unkown Control Id: &quot;</span> + control.Id)\n      <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Select</span>\n\n    <span style=\"color:Blue;\">Catch</span> throwedException <span style=\"color:Blue;\">As</span> Exception\n\n      <span style=\"color:Blue;\">Dim</span> details <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">String</span> = <span style=\"color:Blue;\">String</span>.Format(<span style=\"color:#A31515;\">&quot;{1}{1}Details:{1}{1}{0}&quot;</span>, throwedException.Message, Environment.NewLine)\n      MessageBox.Show(<span style=\"color:#A31515;\">&quot;An error occured in OnAction: &quot;</span> + details, <span style=\"color:#A31515;\">&quot;Error&quot;</span>, MessageBoxButtons.OK, MessageBoxIcon.<span style=\"color:Blue;\">Error</span>)\n\n    <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Try</span>\n  <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Sub</span>\r\n</pre></div>The sample code above demonstrate addin which adds to Excel ribbon <em>Example</em> tab with <em>Go Next Sheet</em> button. The project was generated with NetOffice VS Project Wizard. The button state is invalidated when workbook is opened. The button allows go next/previous sheet and is enabled only for workbooks with more than one sheet. Of course this is unfinished solution: we should handle <em>WorkbookActivate</em> event for the proper button behavior.<br />\nActually there is no need to invalidate control in this example as <em>GetEnabled</em> always works with active workbook. So  <em>WorkbookOpen</em> method is only for demonstration how you can update ribbon control state.<br />\n",
    "PostedDate": "2013-02-18T19:27:18.213-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]