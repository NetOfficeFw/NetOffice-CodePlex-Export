[
  {
    "Id": "722359",
    "ThreadId": "285443",
    "Html": "\r\n<p>Hi Sebastian,</p>\r\n<p>More about (Excel) VBA compatibility.</p>\r\n<p>These are just observations, I'm not sure I have a serious suggestion for something to change yet.</p>\r\n<p>In VBA I write:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">Sub</span> Test()\r\n    <span style=\"color:blue\">Dim</span> i\r\n    <span style=\"color:blue\">Dim</span> j\r\n    <span style=\"color:blue\">Dim</span> x <span style=\"color:blue\">As</span> <span style=\"color:blue\">String</span>\r\n    \r\n    i = xlAboveAverage\r\n    j = XlAboveBelow.xlAboveAverage\r\n    \r\n    x = Format(5.1, <span style=\"color:#a31515\">&quot;0&quot;</span>)\r\n<span style=\"color:blue\">End</span> <span style=\"color:blue\">Sub</span>\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>Now I want to port this to Excel-DNA / NetOffice code with VB.NET. I reference LateBinding.Core.dll and ExcelApi.dll (and probably OfficeApi.dll).</p>\r\n<p>I create a module with the following code:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">Imports</span> NetOffice.ExcelApi.Enums\r\n\r\n<span style=\"color:blue\">Public</span> <span style=\"color:blue\">Module</span> TestEnums\r\n\r\n    <span style=\"color:blue\">Sub</span> Test()\r\n        <span style=\"color:blue\">Dim</span> i\r\n        <span style=\"color:blue\">Dim</span> j\r\n        <span style=\"color:blue\">Dim</span> x <span style=\"color:blue\">As</span> <span style=\"color:blue\">String</span>\r\n\r\n        i = xlAboveAverage <span style=\"color:green\">' &lt;&lt;&lt;&lt;&lt; COMPILER ERROR </span>\r\n        j = XlAboveBelow.xlAboveAverage\r\n\r\n        x = Format(5.1, <span style=\"color:#a31515\">&quot;0&quot;</span>)\r\n    <span style=\"color:blue\">End</span> <span style=\"color:blue\">Sub</span>\r\n\r\n<span style=\"color:blue\">End</span> <span style=\"color:blue\">Module</span>\r\n</pre>\r\n</div>\r\n<p>The compiler error is understandable - there is nothing called xlAboveAverage in the namespace.</p>\r\n<p>Now if I Import the XlAboveAverage type, I get another problem:</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">Imports</span> NetOffice.ExcelApi.Enums\r\n<span style=\"color:blue\">Imports</span> NetOffice.ExcelApi.Enums.XlAboveBelow\r\n\r\n<span style=\"color:blue\">Public</span> <span style=\"color:blue\">Module</span> TestEnums\r\n\r\n    <span style=\"color:blue\">Sub</span> Test()\r\n        <span style=\"color:blue\">Dim</span> i\r\n        <span style=\"color:blue\">Dim</span> j\r\n        <span style=\"color:blue\">Dim</span> x <span style=\"color:blue\">As</span> <span style=\"color:blue\">String</span>\r\n\r\n        i = xlAboveAverage\r\n        j = XlAboveBelow.xlAboveAverage\r\n\r\n        x = Format(5.1, <span style=\"color:#a31515\">&quot;0&quot;</span>) <span style=\"color:green\">' &lt;&lt;&lt;&lt;&lt; COMPILER ERROR</span>\r\n    <span style=\"color:blue\">End</span> <span style=\"color:blue\">Sub</span>\r\n\r\n<span style=\"color:blue\">End</span> <span style=\"color:blue\">Module</span>\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>Now the first xlAboveAverage looks OK, but because the type xlAboveAverage inherits from System.Enum, we have also imported the method System.Enum.Format(...), which now hides the previous Format method in Microsoft.VisualBasic.Strings.</p>\r\n<p>So here's the thought:</p>\r\n<p>If might be useful if ExcelApi had a sealed Constants type with static members (each of the right enum type) for all the constants. That way we could have the above code work directly.</p>\r\n<p>The danger would be that it might increase the size of the assemblies a lot. If so, maybe the VBA compatibility helpers should be in a separate assembly?</p>\r\n<p>&nbsp;</p>\r\n<p>In the Microsoft.VisualBasic assembly there is a type called Microsoft.VisualBasic.Constants, which have the various enum values as constants. Somehow these are all available globally (maybe because to the StandardModule attribute?) Certainly something makes\r\n the type&nbsp;Microsoft.VisualBasic.Constants special, so you only need to say &quot;Imports Microsoft.VisualBasic&quot; and Constant is imported too.</p>\r\n<p>Another example which makes me think the Microsoft.VisualBasic.CompilerServices.StanrdardModuleAttribute is important is the DateTime.Now member. One does not have to import the type for &quot;Now&quot; to be available everywhere. This makes me think if you can add\r\n such &quot;Global&quot; classes added to NetOffice, they should be marked with the&nbsp;Microsoft.VisualBasic.CompilerServices.StanrdardModuleAttribute - at least it's worth investigating.</p>\r\n<p>Right - I'm rambling a bit, but these are some issues I found while exploring how to use NetOffice for VBA -&gt; VB.NET compatibility. None of this is urgent or serious, maybe nice to have features to implement if easy and if it does no harm otherwise.</p>\r\n<p>-Govert</p>\r\n",
    "PostedDate": "2012-01-09T03:38:52.477-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]