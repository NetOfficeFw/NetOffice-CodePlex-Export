[
  {
    "Id": "721917",
    "ThreadId": "285331",
    "Html": "\r\n<p>&nbsp;</p>\r\n<div id=\"gt-res-wrap\">\r\n<div id=\"gt-res-content\">\r\n<div dir=\"ltr\"><span id=\"result_box\" lang=\"en\"><span>I'm from</span>&nbsp;<span>Argentina.</span>&nbsp;<span>I'm an engineer</span>&nbsp;<span>and for several</span>&nbsp;<span>years I have developed</span><span>&nbsp;analysis</span>&nbsp;tools&nbsp;<span>using\r\n Excel and</span>&nbsp;<span>VBA.</span>&nbsp;<span>Last year</span>&nbsp;<span>I decided</span>&nbsp;<span>it was time to</span>&nbsp;<span>change and now</span>&nbsp;<span>I'm&nbsp;</span><span>slowly</span>&nbsp;<span>developing</span>&nbsp;<span>my tools\r\n in .</span>NET (C#)</span>.&nbsp;</div>\r\n<div dir=\"ltr\"><span>I've been</span>&nbsp;<span>exploring your</span>&nbsp;<span>fantastic</span>&nbsp;<span>project for</span>&nbsp;<span>about three weeks.</span>&nbsp;<span>I was able to</span>&nbsp;<span>combine</span>&nbsp;<span>DNA/</span><span>NetOffice</span>,&nbsp;<span>follow\r\n your</span>&nbsp;<span>examples for developing&nbsp;</span><span>COM</span>&nbsp;<span>Add-</span>ins&nbsp;<span>using only</span>&nbsp;<span>NetOffice</span>&nbsp;<span>(I prefer</span>&nbsp;<span>this approach because</span>&nbsp;<span>I did not find</span>&nbsp;<span>similar\r\n tools</span>&nbsp;<span>for Word or</span>&nbsp;<span>PowerPoint</span>&nbsp;<span>DNA)</span>, etc..</div>\r\n<div dir=\"ltr\"></div>\r\n<div dir=\"ltr\"><span id=\"result_box\" lang=\"en\"><span>And now</span>&nbsp;<span>I have the following</span>&nbsp;<span>concerns</span>: Many&nbsp;<span>authors recommend</span>&nbsp;S<span>himming</span>:&nbsp;&nbsp;<span>avoid</span>&nbsp;&nbsp;<span>MSCOREE.DLL&nbsp;</span><span>Hell\r\n (</span>eg&nbsp;<span>Andrew</span>&nbsp;<span>Whitechapel</span>).<br>\r\n<span>&nbsp;</span></span></div>\r\n<div dir=\"ltr\"><span>Your</span>&nbsp;<span>examples</span>&nbsp;<span>finish a</span>&nbsp;<span>step before</span>, registering the&nbsp;<span>dll</span>&nbsp;<span>as they have been</span>&nbsp;<span>compiled.</span></div>\r\n<div dir=\"ltr\"><span id=\"result_box\" lang=\"en\"><span>What are your</span><span>&nbsp;</span><span>recommendations?</span><br>\r\n<span>Have you tried</span><span>&nbsp;</span><span>shimming the solution</span><span>?</span><br>\r\n<span>You have developed</span><span>&nbsp;</span><span>an example</span><span>&nbsp;</span><span>we can</span><span>&nbsp;</span><span>follow?</span></span></div>\r\n<div dir=\"ltr\"><span id=\"result_box\" lang=\"en\"><span>&nbsp;</span><br>\r\n<span>Thanks</span><br>\r\n<span>Marco</span></span></div>\r\n</div>\r\n<div id=\"gt-res-tools\">\r\n<div id=\"gt-res-tools-r\">\r\n<div id=\"gt-res-rate\">\r\n<div>\r\n<div>\r\n<div>\r\n<div><span>&nbsp;</span></div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-01-07T12:38:32.67-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "722160",
    "ThreadId": "285331",
    "Html": "<p>hello marco,</p>\r\n<p>the following workarround works with NetOffice and the MS Interop Assemblies as well.</p>\r\n<p>1.) Make sure you have VC++ installed in Visual Studio<br />2.) Install the COM Shim Wizard for VS2010 http://blogs.msdn.com/b/mshneer/archive/2010/03/19/com-shim-wizards-for-vs-2010.aspx<br />3.) Create a Addin project with NetOffice or Interop assemblies<br />4.) don register this addin project for COM Interop<br />5.) add a COM Shim project to the solution, follow the wizard and read http://msdn.microsoft.com/en-us/library/bb508939.aspx#IsolatingMicrosoftExtensionsCOMShimWizard2-3_HowtheCOMShimWizardWorks<br />6.) now you have a native Shim proxy for your addin(need a register with regsvr32 or install api on other systems)</p>\r\n<p>i create an excel addin sample and add the project to the download section<br /><br />*best regards to Argentina<br />Sebastian</p>",
    "PostedDate": "2012-01-08T12:17:51.34-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "722185",
    "ThreadId": "285331",
    "Html": "<p><span class=\"hps alt-edited\">Thank you very much</span>,</p>\r\n<p><span class=\"hps\">It's amazing</span>&nbsp;<span class=\"hps\">you can respond</span>&nbsp;<span class=\"hps\">so quickly!</span></p>\r\n<p><span class=\"hps\">I downloaded</span><span>&nbsp;</span><span class=\"hps\">your example</span><span>&nbsp;</span><span class=\"hps\">and I will</span><span>&nbsp;</span><span class=\"hps\">try your</span><span>&nbsp;</span><span class=\"hps\">recommendations this week</span><span>.</span><br /><span class=\"hps\">As</span><span>&nbsp;</span><span class=\"hps\">I am a user</span><span>&nbsp;</span><span class=\"hps\">of #</span><span>&nbsp;</span><span class=\"hps\">Develop,</span><span>&nbsp;</span><span class=\"hps\">I'm downloading</span><span>&nbsp;</span><span class=\"hps\">Visual</span><span>&nbsp;</span><span class=\"hps\">C</span><span>&nbsp;</span><span class=\"hps\">+ +</span><span>&nbsp;</span><span class=\"hps\">Express</span><span>&nbsp;to test&nbsp;</span><span class=\"hps\">COM</span><span>&nbsp;</span><span class=\"hps\">Shim</span><span>&nbsp;</span><span class=\"hps\">Wizard</span><span>&nbsp;</span><span class=\"hps\">and analyze</span><span>&nbsp;</span><span class=\"hps\">your example.&nbsp;<span class=\"hps atn\">(</span><span>I hope</span><span>&nbsp;</span><span class=\"hps alt-edited\">can use</span><span>&nbsp;</span><span class=\"hps\">this version</span><span>&nbsp;</span><span class=\"hps\">of</span><span>&nbsp;</span><span class=\"hps\">VS</span><span>)</span></span></p>\r\n<p><span class=\"hps\"><span><span class=\"hps\">I</span><span>'ll let you know</span><span>&nbsp;</span><span class=\"hps\">my progress.</span><br /><span class=\"hps\">Thanks again,</span><br /><span class=\"hps\">regards</span><br /><span class=\"hps\">Marco</span><br /></span></span></p>",
    "PostedDate": "2012-01-08T15:01:35.957-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "722187",
    "ThreadId": "285331",
    "Html": "<p>Hi Marco,</p>\r\n<p>If you are using Excel-DNA with NetOffice, and making an Excel-DNA add-in that references the NetOffice assemblies (instead of a COM add-in that is registered in the registry directly), your add-in is effectively shimmed already. The unmanaged part of the Excel-DNA .xll will load the .NET runtime and create a separate AppDomain where your add-in will reside. So you need no other C++ shim in this case.</p>\r\n<p>Of course this only applies to Excel add-ins.</p>\r\n<p>Regards,</p>\r\n<p>Govert</p>",
    "PostedDate": "2012-01-08T15:06:57.32-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "722227",
    "ThreadId": "285331",
    "Html": "<p>Hi Govert.</p>\r\n<p>I know,</p>\r\n<p>In fact, while waiting for the response of Sebastian, I read the Discussion http://exceldna.codeplex.com/discussions/252721.</p>\r\n<p>Your final post clarifies the situation.</p>\r\n<p>Then, I tried \\ Distribution \\ Samples \\ ComServer.</p>\r\n<p>&nbsp;</p>\r\n<p>Some things I'd like to know more detail are: (Taking the example of ComServer)</p>\r\n<p>&nbsp;</p>\r\n<p>* BuildSample.bat:&nbsp;</p>\r\n<p>What exactly happens when you run regsvr32.exe ComServerPacked.xll?</p>\r\n<p>What are the entries that are included in the registry?</p>\r\n<p>Have you Know any utility that allows capture those entries? (I think something like regasm regfile :...)</p>\r\n<p>&nbsp;</p>\r\n<p>* ComServerSample.dna:</p>\r\n<p>What exactly happens when you run ComServer. (un) DllRegisterServer ()?</p>\r\n<p>What are the entries that are included in the registry?</p>\r\n<p>I have analyzed the source code, but as I have never programmed, I can hardly keep your code.</p>\r\n<p>&nbsp;</p>\r\n<p>* How are handled dependencies when running ExcelDnaPack.exe?</p>\r\n<p>I understand that, as indicated PackDep.dna, the libraries are included in the xll if specified &lt;Reference Pack=\"true\" AssemblyPath=\"DepLib.dll\" /&gt;</p>\r\n<p>What are your recommendations?</p>\r\n<p>NetOffice libraries and other (eg, usually I have my own library of utilities)</p>\r\n<p>It should be packaged or leave them outside? What are the advantages of each method?</p>\r\n<p>&nbsp;</p>\r\n<p><span class=\"hps\">thank you very much</span><br /><span class=\"hps\">regards</span></p>\r\n<p><span class=\"hps\">Marco</span></p>",
    "PostedDate": "2012-01-08T18:34:35.823-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "722282",
    "ThreadId": "285331",
    "Html": "<p>Hi Marco,</p>\r\n<p>The Excel-DNA part of this discussion is probably better to continue on the Excel-DNA Google group: &nbsp;<a href=\"http://groups.google.com/group/exceldna\">http://groups.google.com/group/exceldna</a>.</p>\r\n<p>Registration of the Com Server classes is under&nbsp;HKEY_CURRENT_USER\\Software\\Classes\\. You'll easily&nbsp;see what's going on if you look in the registry, but the code is in ExcelDna.Integration\\ComServer.cs. Invoking regsvr32.exe will eventually call ComServer.DllRegisterServer(), so they do exactly the same work.</p>\r\n<p>Entries are basically:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre> \"HKEY_CURRENT_USER\\Software\\Classes\\\" + ProgId\r\n \"HKEY_CURRENT_USER\\Software\\Classes\\\" + ClsId + .... (InprocServer32 etc.)\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>and possibly a TypeLib entry under HKEY_CURRENT_USER\\Software\\Classes\\TypeLib\\. The \"server\" for the COM type is registered as the .xll, which has the correct exports to be a COM Server.</p>\r\n<p>You can have the various NetOffice assemblies packed by adding the &lt;Reference Path=\"...\" Pack=\"true\" /&gt; tags in the .dna file, exactly as you show. It does not work for mixed code (assemblies that contain native code). I packed the files LateBinding.Core.dll, ExcepApi.dll, OfficeApi.dll, DaoApi.dll and a small add-in library into an .xll recently, and the resulting size was 726KB.&nbsp;</p>\r\n<p>The packing works fine in my experience, and it's pretty nice to have a single-file add-in. Packing does change how those assemblies are loaded by .NET (they are in a different \"Load context\") which can sometimes cause confusion.&nbsp;It just makes deployment much easier, but is not crucial to the add-in structure or how it works.&nbsp;If you want to have many add-ins in the same directory that share the NetOffice libraries, it might make sense not to pack them.</p>\r\n<p>Packing or not is a decision you can take very late, once everything works.</p>\r\n<p>Regards,</p>\r\n<p>Govert</p>",
    "PostedDate": "2012-01-08T23:45:35.057-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]