<?xml version="1.0" encoding="utf-8"?>
<CodeplexIssue xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>21953</Id>
  <Title>NetOffice ExcelAPI Causing 500 Error</Title>
  <DescriptionHtml xml:space="preserve"><![CDATA[I have a web application that uses NetOffice ExcelAPI. All works okay on the local development machine, but when I deploy the application to the server and run the app I get a 500 error. The log file doesn't seem to register that such an event has occurred
 but, by process of elimination, I have determined it is the NetOffice ExcelAPI that triggers the 500 error.

Interestingly, I have two other web applications on the same server using the same version of NetOffice.ExcelAPI that run without any issues.

Can anyone offer any troubleshooting tips that might provide some light on why I get the 500 error?]]></DescriptionHtml>
  <Status>Proposed</Status>
  <Type>Unassigned</Type>
  <Impact>Unassigned</Impact>
  <Comments>
    <CodeplexComment>
      <Author>SebastianDotNet</Author>
      <BodyHtml xml:space="preserve"><![CDATA[Where is the 500 error number comes from? its never an MS-Excel or COM error code.


stack trace, full-recursive(!!!) exception details. put all what you have here please.


currently i all what i know is: "NetOffice Error" 

the 500 error comes from your web app but i need to see the problem behind directly from NetOffice.(the stack strace and exception info may include that)


*Sebastian]]></BodyHtml>
      <CreatedAt>2015-07-29T21:22:29.0000000+02:00</CreatedAt>
    </CodeplexComment>
    <CodeplexComment>
      <Author>normality2000</Author>
      <BodyHtml xml:space="preserve"><![CDATA[Sebastian,The NetOffice ExcelAPI has been installed using nuget. I have one line of code within the application that just creates a new Excel object. The stacktrace that is returned is as follows:


Server Error in '/TestExcelAPI' Application.--------------------------------------------------------------------------------


Retrieving the COM class factory for component with CLSID {00024500-0000-0000-C000-000000000046} failed due to the following error: 80070005 Access is denied. (Exception from HRESULT: 0x80070005 (E_ACCESSDENIED)). Description: An unhandled exception occurred
 during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.


Exception Details: System.UnauthorizedAccessException: Retrieving the COM class factory for component with CLSID {00024500-0000-0000-C000-000000000046} failed due to the following error: 80070005 Access is denied. (Exception from HRESULT: 0x80070005 (E_ACCESSDENIED)).


ASP.NET is not authorized to access the requested resource. Consider granting access rights to the resource to the ASP.NET request identity. ASP.NET has a base process identity (typically {MACHINE}\ASPNET on IIS 5 or Network Service on IIS 6 and IIS 7, and
 the configured application pool identity on IIS 7.5) that is used if the application is not impersonating. If the application is impersonating via , the identity will be the anonymous user (typically IUSR_MACHINENAME) or the authenticated request user.


To grant ASP.NET access to a file, right-click the file in Explorer, choose "Properties" and select the Security tab. Click "Add" to add the appropriate user or group. Highlight the ASP.NET account, and check the boxes for the desired access.


Source Error: 

An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.

Stack Trace: 

[UnauthorizedAccessException: Retrieving the COM class factory for component with CLSID {00024500-0000-0000-C000-000000000046} failed due to the following error: 80070005 Access is denied. (Exception from HRESULT: 0x80070005 (E_ACCESSDENIED)).] System.Runtime.Remoting.RemotingServices.AllocateUninitializedObject(RuntimeType
 objectType) +0 System.Runtime.Remoting.Activation.ActivationServices.CreateInstance(RuntimeType serverType) +79 System.Runtime.Remoting.Activation.ActivationServices.IsCurrentContextOK(RuntimeType serverType, Object[] props, Boolean bNewObj) +76 System.RuntimeTypeHandle.CreateInstance(RuntimeType
 type, Boolean publicOnly, Boolean noCheck, Boolean& canBeCached, RuntimeMethodHandleInternal& ctor, Boolean& bNeedSecurityCheck) +0 System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean skipCheckThis, Boolean fillCache) +98 System.RuntimeType.CreateInstanceDefaultCtor(Boolean
 publicOnly, Boolean skipVisibilityChecks, Boolean skipCheckThis, Boolean fillCache) +241 System.Activator.CreateInstance(Type type, Boolean nonPublic) +69 NetOffice.COMObject.CreateFromProgId(String progId) +51 NetOffice.COMObject..ctor(String progId) +69
 NetOffice.ExcelApi.Application..ctor() +19 ExcelTestAPI._Default.Page_Load(Object sender, EventArgs e) in D:\PROJECTS\VisualStudio2012\ExcelTestAPI\ExcelTestAPI\Default.aspx.vb:7 System.Web.UI.Control.OnLoad(EventArgs e) +91 System.Web.UI.Control.LoadRecursive()
 +74 System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +2207


One interesting item that I note is the line that reads ' ExcelTestAPI._Default.Page_Load(Object sender, EventArgs e) in D:\PROJECTS\VisualStudio2012\ExcelTestAPI\ExcelTestAPI\Default.aspx.vb:7'.


This is referencing the development machine rather than the server. Could this have anything to do with the problem? If so, how would I go about fixing it.


As I have said before, we have other applications that use ExcelAPI and found it to be a wonderful product to code with and produce quality MS Office documents, so I am convinced that the error lies at my end but I just cannot fathom it out.


Any help would be appreciated. 



--------------------------------------------------------------------------------Version Information: Microsoft .NET Framework Version:4.0.30319; ASP.NET Version:4.0.30319.1031]]></BodyHtml>
      <CreatedAt>2015-07-30T17:55:10.0000000+02:00</CreatedAt>
    </CodeplexComment>
    <CodeplexComment>
      <Author>SebastianDotNet</Author>
      <BodyHtml xml:space="preserve"><![CDATA[Its a common error i believe. 

Its not allowed to create a COM component(which it is) from local system account.(E_ACCESSDENIED)this topic shows you different options to resolve the problem.


<a href="http://stackoverflow.com/questions/17785063/retrieving-the-com-class-factory-for-component-error-80070005-access-is-de" rel="nofollow">http://stackoverflow.com/questions/17785063/retrieving-the-com-class-factory-for-component-error-80070005-access-is-de</a>


(best way on is to use open-xml of course - if possible. no excel requiered here. The ClosedXML project here on codeplex is such great. give'em a try if you can)


*Sebastian]]></BodyHtml>
      <CreatedAt>2015-07-31T20:00:10.0000000+02:00</CreatedAt>
    </CodeplexComment>
  </Comments>
  <ReportedBy>normality2000</ReportedBy>
  <ReportedAt>2015-07-28T16:18:04.0000000+00:00</ReportedAt>
</CodeplexIssue>