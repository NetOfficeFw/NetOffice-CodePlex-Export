<?xml version="1.0" encoding="utf-8"?>
<CodeplexIssue xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>22037</Id>
  <Title>NullReferenceException on ExcelApi.Application.GetActiveInstances()</Title>
  <DescriptionHtml xml:space="preserve"><![CDATA[Hi,

calling 
<pre><code>ExcelApi.Application.GetActiveInstances()</code></pre>
with an open Excel instance which has no workbooks visibly opened (i.e. start excel and close or hide the default workbook) causes a NullReferenceException.


I tracked it down to the excel hot fix in GetActiveProxiesFromROT and the subsequent proxy lookup by hWnd.
If no workbook is visible there seems to be no EXCEL7 window and the lookup returns a null reference, which then causes the NullReferenceException on COMObject instantiation.

Best regards,
Andreas]]></DescriptionHtml>
  <Status>Proposed</Status>
  <Type>Unassigned</Type>
  <Impact>Unassigned</Impact>
  <Comments>
    <CodeplexComment>
      <Author>SebastianDotNet</Author>
      <BodyHtml xml:space="preserve"><![CDATA[thanks for the notification. the main problem behind is: you can see all COM instance in ROT but only the first is accessible. This is why GetActiveObject in VB6/VBA has the same problem. You can't decide which instance you want and i've been implemented
 the hotfix.

Is it NetOffice 1.7.3 ? 

I want change the implementation this weekend. 

*Sebastian]]></BodyHtml>
      <CreatedAt>2015-11-13T17:50:17.0000000+01:00</CreatedAt>
    </CodeplexComment>
    <CodeplexComment>
      <Author>SebastianDotNet</Author>
      <BodyHtml xml:space="preserve"><![CDATA[BTW: do you have a stack trace, exception details(error code line number, etc.) for me?Its more safe to pin point the (real)problem once and for all.


*Sebastian]]></BodyHtml>
      <CreatedAt>2015-11-15T19:42:35.0000000+01:00</CreatedAt>
    </CodeplexComment>
    <CodeplexComment>
      <Author>LockeLink</Author>
      <BodyHtml xml:space="preserve"><![CDATA[Hi Sebastain,

I ran into this same problem today using NetOffice 1.7.3. I was able to find the 'GetActiveProxiesFromROT ' that Andreas mentioned. I created a brand new project, downloaded the NetOffice ExcelApi and put the following code in and it errors as they described.


For anyone else that runs into this problem the code shows how I get around the problem using the NetOffice.RunningObjectTable class.

Even with this issue NetOffice is a great library that I use a lot! Thanks!

-Locke
<pre><code>using System.Linq

class Program
    {
        static void Main(string[] args)
        {
            using (var application = new NetOffice.ExcelApi.Application())
            using (var application2 = new NetOffice.ExcelApi.Application())
            {
                application.Visible = true;
                application2.Visible = true;

                application.Workbooks.Add();
                application2.Workbooks.Add();

                //OK
                var applications = NetOffice.ExcelApi.Application.GetActiveInstances();

                foreach (var wb in application2.Workbooks)
                    wb.Close(false);

                //OK, though it will be missing "application2" because no workbooks are open.
                applications = NetOffice.RunningObjectTable
                    .GetActiveProxiesFromROT("Excel", "Application")
                    .Where(p => p != null)
                    .Select(p => new NetOffice.ExcelApi.Application(null, p))
                    .ToArray();

                //Not OK, this will error
                var applicationsError = NetOffice.ExcelApi.Application.GetActiveInstances();

                application.Quit();
                application2.Quit();
            }
        }
    }</code></pre>]]></BodyHtml>
      <CreatedAt>2016-12-01T21:13:25.0000000+01:00</CreatedAt>
    </CodeplexComment>
  </Comments>
  <ReportedBy>nullsys</ReportedBy>
  <ReportedAt>2015-10-07T11:35:51.0000000+00:00</ReportedAt>
</CodeplexIssue>